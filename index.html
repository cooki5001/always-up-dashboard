<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Always Up (Vibe) Dashboard</title>
  <meta name="description" content="Always-up vibe charts + sentiment + M2. Free data dashboard." />
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <style>
    /* --------- Theme --------- */
    :root{
      --bg0:#eaffef;
      --bg1:#ffffff;
      --txt:#0b0b0b;
      --muted:rgba(0,0,0,.62);
      --muted2:rgba(0,0,0,.45);
      --card:rgba(255,255,255,.72);
      --border:rgba(0,0,0,.08);
      --shadow: 0 18px 60px -40px rgba(0,0,0,.35);
      --pill:rgba(255,255,255,.65);
      --accent:#0b0b0b;
      --accentTxt:#ffffff;
      --goodBg: rgba(16,185,129,.10);
      --goodBd: rgba(16,185,129,.22);
      --goodTx: rgba(6,95,70,.95);
      --warnBg: rgba(245,158,11,.12);
      --warnBd: rgba(245,158,11,.25);
      --warnTx: rgba(146,64,14,.95);
    }
    [data-theme="dark"]{
      --bg0:#0b1220;
      --bg1:#070b14;
      --txt:#ffffff;
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.46);
      --card:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.12);
      --shadow: 0 18px 60px -40px rgba(0,0,0,.85);
      --pill:rgba(255,255,255,.08);
      --accent:#ffffff;
      --accentTxt:#0b0b0b;
      --goodBg: rgba(16,185,129,.10);
      --goodBd: rgba(16,185,129,.22);
      --goodTx: rgba(167,243,208,.92);
      --warnBg: rgba(245,158,11,.12);
      --warnBd: rgba(245,158,11,.25);
      --warnTx: rgba(253,230,138,.90);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: linear-gradient(to bottom, var(--bg0), var(--bg1) 45%, var(--bg1));
      color:var(--txt);
      -webkit-tap-highlight-color: transparent;
    }
    a{ color:inherit; }
    .wrap{ max-width:1120px; margin:0 auto; padding:26px 18px 42px; }
    .top{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:14px; flex-wrap:wrap;
    }

    /* --------- Header --------- */
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:40px; height:40px; border-radius:16px;
      border:1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      backdrop-filter: blur(12px);
    }
    .logo svg{ opacity:.92; }
    h1{ margin:0; font-size:26px; letter-spacing:-0.02em; }
    .sub{ margin-top:8px; color:var(--muted); font-size:13px; max-width:720px; }

    /* --------- Buttons / Chips --------- */
    .btn{
      border-radius:16px;
      border:1px solid var(--border);
      background: var(--card);
      padding:10px 12px;
      cursor:pointer;
      display:inline-flex; align-items:center; gap:8px;
      backdrop-filter: blur(12px);
      transition: transform .12s ease, opacity .12s ease, background .12s ease;
      box-shadow: 0 10px 34px -26px rgba(0,0,0,.45);
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px) scale(.99); opacity:.95; }
    .btn.primary{
      background: var(--accent);
      border-color: var(--accent);
      color: var(--accentTxt);
    }
    .btn.ghost{
      background: transparent;
      box-shadow:none;
    }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; transform:none; }

    .chip{
      display:inline-flex; align-items:center; gap:7px;
      border-radius:999px;
      padding:7px 11px;
      background: var(--pill);
      border:1px solid var(--border);
      color: var(--muted);
      font-size:12px;
      backdrop-filter: blur(12px);
      white-space:nowrap;
    }
    .chip.good{ background: var(--goodBg); border-color: var(--goodBd); color: var(--goodTx); }
    .chip.warn{ background: var(--warnBg); border-color: var(--warnBd); color: var(--warnTx); }

    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:16px; }

    /* --------- Segmented --------- */
    .seg{
      display:inline-flex;
      padding:4px;
      border-radius:999px;
      border:1px solid var(--border);
      background: var(--pill);
      backdrop-filter: blur(12px);
    }
    .seg button{
      border:0; background:transparent; cursor:pointer;
      padding:10px 14px; border-radius:999px;
      color: var(--muted);
      font-size:14px;
      transition: background .12s ease, color .12s ease;
    }
    .seg button.active{
      background: var(--accent);
      color: var(--accentTxt);
    }

    /* --------- Layout Cards --------- */
    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top:14px; }
    @media (max-width: 900px){ .grid{ grid-template-columns:1fr; } }

    .gridWide{ display:grid; grid-template-columns: 2fr 1fr; gap:12px; margin-top:12px; }
    @media (max-width: 980px){ .gridWide{ grid-template-columns:1fr; } }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px; }
    @media (max-width: 900px){ .grid2{ grid-template-columns:1fr; } }

    .card{
      border-radius:22px;
      border:1px solid var(--border);
      background: var(--card);
      padding:16px;
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:-1px;
      background: radial-gradient(1200px 220px at 20% 0%, rgba(16,185,129,.12), transparent 55%);
      pointer-events:none;
      opacity:.55;
    }
    [data-theme="dark"] .card:before{
      opacity:.22;
    }
    .k{ color:var(--muted); font-size:12px; position:relative; }
    .v{ font-size:24px; font-weight:760; margin-top:7px; letter-spacing:-0.02em; position:relative; }
    .mini{ color:var(--muted2); font-size:12px; margin-top:6px; position:relative; }
    .chart{ height: 340px; margin-top: 10px; position:relative; }
    .chart.sm{ height: 250px; }

    .footer{ margin-top:18px; color:var(--muted2); font-size:12px; line-height:1.45; }

    /* --------- Loading shimmer --------- */
    .shimmer{
      height:14px; width:120px; border-radius:999px;
      background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.20), rgba(255,255,255,.06));
      background-size: 200% 100%;
      animation: shimmer 1.2s infinite linear;
      border:1px solid var(--border);
    }
    [data-theme="dark"] .shimmer{
      background: linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.12), rgba(255,255,255,.04));
    }
    @keyframes shimmer{
      0%{ background-position: 0% 0; }
      100%{ background-position: 200% 0; }
    }

    /* small icon helpers */
    .ico{ width:16px; height:16px; display:inline-block; vertical-align:middle; }
    .spin{ animation: spin 1s linear infinite; }
    @keyframes spin{ to{ transform: rotate(360deg); } }
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- Trending up icon -->
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 17l6-6 4 4 8-8" />
            <path d="M14 7h7v7" />
          </svg>
        </div>
        <h1>Always Up (Vibe) Dashboard</h1>
        <span class="chip good" style="margin-left:4px;">
          <!-- sparkles -->
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2l1.2 4.2L17 7.4l-3.8 1.2L12 13l-1.2-4.4L7 7.4l3.8-1.2L12 2z"/>
            <path d="M20 12l.7 2.4L23 15l-2.3.6L20 18l-.7-2.4L17 15l2.3-.6L20 12z"/>
            <path d="M4 13l.8 2.6L7 16l-2.2.6L4 19l-.8-2.4L1 16l2.2-.4L4 13z"/>
          </svg>
          vibes
        </span>
      </div>
      <div class="sub">무료 데이터로 “항상 우상향” 차트 + 심리지표 + M2 + 수익률 (GitHub Pages용 단일 파일)</div>
    </div>

    <div class="row" style="margin-top:0;">
      <button id="toggleTheme" class="btn" title="Dark/Light">
        <!-- moon/sun icon changes via JS -->
        <span id="themeIcon" aria-hidden="true">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.8A8.5 8.5 0 1 1 11.2 3a6.5 6.5 0 0 0 9.8 9.8z"/>
          </svg>
        </span>
        <span id="themeLabel" style="font-size:13px;">Dark</span>
      </button>

      <button id="refresh" class="btn primary">
        <span id="refreshIcon" aria-hidden="true">
          <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 1 1-3-6.7"/>
            <path d="M21 3v7h-7"/>
          </svg>
        </span>
        Refresh
      </button>
    </div>
  </div>

  <div class="row">
    <div class="seg" role="tablist" aria-label="Asset tabs">
      <button id="tabStocks" class="active" role="tab" aria-selected="true">Stocks</button>
      <button id="tabCrypto" role="tab" aria-selected="false">Crypto</button>
    </div>

    <span id="fgStocks" class="chip">Stocks F&G: <span class="shimmer" style="height:10px;width:64px;border-radius:999px;"></span></span>
    <span id="fgCrypto" class="chip">Crypto F&G: <span class="shimmer" style="height:10px;width:64px;border-radius:999px;"></span></span>

    <span class="chip" title="Definition">
      log return → abs() → accumulate
    </span>
  </div>

  <div class="grid">
    <div class="card">
      <div class="k">SPY 1Y Return</div>
      <div id="spyRet" class="v"><span class="shimmer" style="width:120px;"></span></div>
      <div class="mini">(Stooq daily CSV 기준)</div>
    </div>
    <div class="card">
      <div class="k">QQQ 1Y Return</div>
      <div id="qqqRet" class="v"><span class="shimmer" style="width:120px;"></span></div>
      <div class="mini">(Stooq daily CSV 기준)</div>
    </div>
    <div class="card">
      <div class="k">Mode</div>
      <div id="mode" class="v">Stocks</div>
      <div class="mini">Vibe chart는 “절대수익률 누적”</div>
    </div>
  </div>

  <div class="gridWide">
    <div class="card">
      <div class="k">Vibe Chart (항상 우상향)</div>
      <div id="titleVibe" class="v" style="font-size:18px; margin-top:8px;">SPY (vibe-adjusted)</div>
      <div id="chartVibe" class="chart"></div>
      <div class="mini">Normalized to 100 (시작점을 100으로 맞춤)</div>
    </div>

    <div class="card">
      <div class="k">Raw vs Vibe</div>
      <div id="titleRaw" class="v" style="font-size:18px; margin-top:8px;">SPY</div>
      <div id="chartRaw" class="chart"></div>
      <div class="mini">실제 가격 vs vibe 가격</div>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="k">M2 Money Supply (US)</div>
      <div class="v" style="font-size:18px; margin-top:8px;">FRED M2SL</div>
      <div id="chartM2US" class="chart sm"></div>
    </div>
    <div class="card">
      <div class="k">M2 Money Supply (Korea)</div>
      <div class="v" style="font-size:18px; margin-top:8px;">FRED Korea M2 (historical)</div>
      <div id="chartM2KR" class="chart sm"></div>
    </div>
  </div>

  <div class="footer">
    ✅ Crypto Fear & Greed: Alternative.me (무료).<br/>
    ✅ Stocks “F&G”: MVP에서는 CNN 대신 VIX 기반 간이 지표(무료/안정).<br/>
    ✅ M2: FRED CSV(키 없이).<br/>
    ※ 무료 소스는 가끔 느릴 수 있어요. (그래서 Refresh 버튼/로딩 처리)
  </div>
</div>

<script>
  // ----------------- Helpers -----------------
  const JINAS = (url) => `https://r.jina.ai/https://${url.replace(/^https?:\/\//,'')}`;

  function parseCSV(text) {
    const lines = text.trim().split(/\r?\n/);
    const header = lines[0].split(',');
    const rows = [];
    for (let i=1;i<lines.length;i++){
      const cols = lines[i].split(',');
      if (cols.length !== header.length) continue;
      const obj = {};
      header.forEach((h, idx) => obj[h.trim()] = cols[idx].trim());
      rows.push(obj);
    }
    return rows;
  }

  function pctChange(a,b){ return ((b-a)/a)*100; }

  // Up-only transform: abs(log returns) cumulative; normalize 100
  function vibeSeries(points) {
    if (!points.length) return [];
    let acc = Math.log(points[0].p);
    const out = [{t: points[0].t, vibe: points[0].p}];
    for (let i=1;i<points.length;i++){
      const prev = points[i-1].p;
      const cur = points[i].p;
      const r = Math.log(cur/prev);
      acc += Math.abs(r);
      out.push({t: points[i].t, vibe: Math.exp(acc)});
    }
    const base = out[0].vibe;
    return out.map(x => ({t:x.t, vibe:x.vibe, vibeNorm:(x.vibe/base)*100}));
  }

  function labelFG(v){
    if (v<=25) return "Extreme Fear";
    if (v<=45) return "Fear";
    if (v<=55) return "Neutral";
    if (v<=75) return "Greed";
    return "Extreme Greed";
  }

  function fgToneClass(v){
    if (v<=45) return "warn";
    if (v>=60) return "good";
    return "";
  }

  // MVP stocks F&G from VIX (free)
  function vixToFG(vix){
    const v = Math.max(10, Math.min(45, vix));
    const score = 100 - ((v - 10) / (45 - 10)) * 85; // invert
    return Math.round(Math.max(0, Math.min(100, score)));
  }

  // ----------------- Free data fetchers -----------------
  async function fetchStooqDaily(symbol) {
    const url = `https://stooq.com/q/d/l/?s=${symbol}&i=d`;
    const txt = await fetch(JINAS(url)).then(r=>r.text());
    const rows = parseCSV(txt);
    const pts = rows
      .filter(r=>r.Date && r.Close && r.Close !== "null")
      .map(r => ({ t: r.Date, p: Number(r.Close) }));
    return pts.slice(-365);
  }

  async function fetchVIX() {
    return fetchStooqDaily("vix");
  }

  async function fetchCryptoBTC() {
    const url = "https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=365";
    const js = await fetch(url).then(r=>r.json());
    return js.prices.map(([ms, p]) => {
      const d = new Date(ms);
      const t = d.toISOString().slice(0,10);
      return { t, p };
    });
  }

  async function fetchCryptoFG() {
    const url = "https://api.alternative.me/fng/?limit=1";
    const js = await fetch(url).then(r=>r.json());
    return Number(js?.data?.[0]?.value ?? 50);
  }

  async function fetchFREDcsv(seriesId) {
    const url = `https://fred.stlouisfed.org/graph/fredgraph.csv?id=${seriesId}`;
    const txt = await fetch(JINAS(url)).then(r=>r.text());
    const rows = parseCSV(txt);
    const key = seriesId;
    return rows
      .filter(r => r.DATE && r[key] && r[key] !== ".")
      .map(r => ({ t: r.DATE, v: Number(r[key]) }));
  }

  // ----------------- ECharts setup -----------------
  const chartVibe = echarts.init(document.getElementById("chartVibe"));
  const chartRaw  = echarts.init(document.getElementById("chartRaw"));
  const chartM2US = echarts.init(document.getElementById("chartM2US"));
  const chartM2KR = echarts.init(document.getElementById("chartM2KR"));

  function axisTheme(){
    const isDark = document.documentElement.getAttribute("data-theme")==="dark";
    return {
      axisLine: { lineStyle:{ color: isDark ? "rgba(255,255,255,.18)" : "rgba(0,0,0,.12)" } },
      axisTick: { show:false },
      axisLabel: { color: isDark ? "rgba(255,255,255,.55)" : "rgba(0,0,0,.45)", fontSize:11 },
      splitLine: { lineStyle:{ color: isDark ? "rgba(255,255,255,.06)" : "rgba(0,0,0,.06)" } }
    };
  }

  function mkOption({title, x, series, area=false}){
    const isDark = document.documentElement.getAttribute("data-theme")==="dark";
    const grid = { left: 12, right: 12, top: 28, bottom: 18, containLabel: true };
    const ax = axisTheme();
    return {
      animationDuration: 500,
      title: { text: title, left: 0, top: 0, textStyle:{ fontSize: 12, fontWeight: 650, color: isDark ? "#fff" : "#0b0b0b" } },
      tooltip: {
        trigger: 'axis',
        backgroundColor: isDark ? "rgba(10,12,18,.92)" : "rgba(255,255,255,.92)",
        borderColor: isDark ? "rgba(255,255,255,.12)" : "rgba(0,0,0,.12)",
        textStyle:{ color: isDark ? "rgba(255,255,255,.85)" : "rgba(0,0,0,.80)" },
        extraCssText: "backdrop-filter: blur(8px); border-radius: 12px;"
      },
      grid,
      xAxis: { type:'category', data:x, boundaryGap:false, ...ax, axisLabel:{...ax.axisLabel, show:false} },
      yAxis: { type:'value', ...ax, axisLabel:{...ax.axisLabel, show:false}, splitLine:{...ax.splitLine, show:false} },
      series: series.map(s => ({
        ...s,
        type:'line',
        showSymbol:false,
        smooth: true,
        lineStyle:{ width: 2 },
        areaStyle: area ? { opacity: 0.16 } : undefined
      })),
    };
  }

  // ----------------- App state -----------------
  let tab = "stocks";
  let SPY=[], QQQ=[], BTC=[], VIX=[];
  let M2US=[], M2KR=[];
  let cryptoFG = 50;

  function setTab(next){
    tab = next;
    const stocksBtn = document.getElementById("tabStocks");
    const cryptoBtn = document.getElementById("tabCrypto");
    stocksBtn.classList.toggle("active", tab==="stocks");
    cryptoBtn.classList.toggle("active", tab==="crypto");
    stocksBtn.setAttribute("aria-selected", tab==="stocks");
    cryptoBtn.setAttribute("aria-selected", tab==="crypto");

    document.getElementById("mode").textContent = tab==="stocks" ? "Stocks" : "Crypto";
    render();
  }

  function compute1YReturn(series){
    if (!series.length) return 0;
    return pctChange(series[0].p, series[series.length-1].p);
  }

  function render(){
    // returns
    const spyRet = compute1YReturn(SPY);
    const qqqRet = compute1YReturn(QQQ);
    document.getElementById("spyRet").textContent = isFinite(spyRet) ? spyRet.toFixed(2) + "%" : "-";
    document.getElementById("qqqRet").textContent = isFinite(qqqRet) ? qqqRet.toFixed(2) + "%" : "-";

    // Fear & Greed
    const vixLatest = VIX.length ? VIX[VIX.length-1].p : 20;
    const stockFG = vixToFG(vixLatest);

    const fgStocksEl = document.getElementById("fgStocks");
    fgStocksEl.className = "chip " + fgToneClass(stockFG);
    fgStocksEl.textContent = `Stocks F&G: ${stockFG} (${labelFG(stockFG)}) • VIX≈${vixLatest.toFixed(1)}`;

    const fgCryptoEl = document.getElementById("fgCrypto");
    fgCryptoEl.className = "chip " + fgToneClass(cryptoFG);
    fgCryptoEl.textContent = `Crypto F&G: ${cryptoFG} (${labelFG(cryptoFG)})`;

    // active series
    const active = tab==="stocks" ? SPY : BTC;
    const activeName = tab==="stocks" ? "SPY" : "BTC";
    document.getElementById("titleVibe").textContent = `${activeName} (vibe-adjusted)`;
    document.getElementById("titleRaw").textContent = activeName;

    // Vibe
    const vibe = vibeSeries(active);
    const x = vibe.map(d=>d.t);
    chartVibe.setOption(mkOption({
      title: "Vibe (Normalized=100)",
      x,
      series: [{ name:"Vibe", data: vibe.map(d=>d.vibeNorm) }],
      area:true
    }), true);

    // Raw vs vibe
    const rawX = active.map(d=>d.t);
    const raw = active.map(d=>d.p);
    const vibeRaw = vibe.map(d=>d.vibe);
    chartRaw.setOption(mkOption({
      title: "Raw vs Vibe",
      x: rawX,
      series: [
        { name:"Raw", data: raw },
        { name:"Vibe", data: vibeRaw }
      ],
      area:false
    }), true);

    // M2 charts (last ~10y)
    const m2us = M2US.slice(-120);
    chartM2US.setOption(mkOption({
      title:"US M2 (M2SL)",
      x: m2us.map(d=>d.t),
      series:[{ name:"M2US", data: m2us.map(d=>d.v) }],
      area:true
    }), true);

    const m2kr = M2KR.slice(-120);
    chartM2KR.setOption(mkOption({
      title:"Korea M2 (FRED)",
      x: m2kr.map(d=>d.t),
      series:[{ name:"M2KR", data: m2kr.map(d=>d.v) }],
      area:true
    }), true);

    chartVibe.resize(); chartRaw.resize(); chartM2US.resize(); chartM2KR.resize();
  }

  function setLoading(isLoading){
    const btn = document.getElementById("refresh");
    const icon = document.getElementById("refreshIcon");
    btn.disabled = isLoading;
    if (isLoading){
      icon.classList.add("spin");
      btn.textContent = " Loading…";
      btn.prepend(icon);
    } else {
      icon.classList.remove("spin");
      btn.textContent = " Refresh";
      btn.prepend(icon);
    }
  }

  async function loadAll(){
    setLoading(true);
    try{
      [SPY, QQQ, BTC, VIX, cryptoFG, M2US, M2KR] = await Promise.all([
        fetchStooqDaily("spy.us"),
        fetchStooqDaily("qqq.us"),
        fetchCryptoBTC(),
        fetchVIX(),
        fetchCryptoFG(),
        fetchFREDcsv("M2SL"),
        fetchFREDcsv("MYAGM2KRM189S"),
      ]);
      render();
    } catch (e){
      alert("데이터 로딩 실패: " + (e?.message || e));
      console.error(e);
    } finally {
      setLoading(false);
    }
  }

  // ----------------- Theme -----------------
  const THEME_KEY = "alwaysup_theme";
  function setTheme(theme){
    document.documentElement.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);
    // update theme button label/icon
    const iconWrap = document.getElementById("themeIcon");
    const label = document.getElementById("themeLabel");
    if (theme==="dark"){
      label.textContent = "Light";
      iconWrap.innerHTML = `
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.8A8.5 8.5 0 1 1 11.2 3a6.5 6.5 0 0 0 9.8 9.8z"/>
        </svg>`;
    } else {
      label.textContent = "Dark";
      iconWrap.innerHTML = `
        <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="4" />
          <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" />
        </svg>`;
    }
    // re-theme charts
    render();
  }

  function toggleTheme(){
    const cur = document.documentElement.getAttribute("data-theme") || "dark";
    setTheme(cur==="dark" ? "light" : "dark");
  }

  // ----------------- Events -----------------
  document.getElementById("tabStocks").addEventListener("click", ()=>setTab("stocks"));
  document.getElementById("tabCrypto").addEventListener("click", ()=>setTab("crypto"));
  document.getElementById("refresh").addEventListener("click", loadAll);
  document.getElementById("toggleTheme").addEventListener("click", toggleTheme);
  window.addEventListener("resize", ()=>{ chartVibe.resize(); chartRaw.resize(); chartM2US.resize(); chartM2KR.resize(); });

  // ----------------- Boot -----------------
  const savedTheme = localStorage.getItem(THEME_KEY);
  setTheme(savedTheme || "dark");
  loadAll();
</script>
</body>
</html>
